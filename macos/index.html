<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScalarDB macOS Installation Wizard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #1d1d1f;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            border-radius: 20px;
            min-height: 100vh;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .header {
            background: linear-gradient(135deg, #1d1d1f 0%, #2d2d30 100%);
            color: white;
            padding: 40px;
            text-align: center;
            border-radius: 20px 20px 0 0;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.03)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .logo-area {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin-bottom: 20px;
        }

        .logo-text {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(45deg, #007AFF, #5856D6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 12px;
            letter-spacing: -0.025em;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            font-weight: 400;
        }

        .progress-container {
            background: rgba(0, 0, 0, 0.02);
            padding: 20px 40px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .progress-bar {
            height: 6px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 16px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #007AFF, #5856D6);
            width: 14.3%;
            transition: width 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            border-radius: 3px;
        }

        .step-info {
            text-align: center;
            color: #6e6e73;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .content {
            padding: 40px;
        }

        .step {
            display: none;
            animation: fadeInUp 0.6s ease-out;
        }

        .step.active {
            display: block;
        }

        @keyframes fadeInUp {
            from { 
                opacity: 0; 
                transform: translateY(30px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }

        .step h2 {
            color: #1d1d1f;
            margin-bottom: 24px;
            font-size: 2rem;
            font-weight: 600;
            border-bottom: 3px solid #007AFF;
            padding-bottom: 12px;
        }

        .step-description {
            color: #6e6e73;
            font-size: 1.1rem;
            margin-bottom: 32px;
            line-height: 1.7;
        }

        .requirements-check {
            background: linear-gradient(135deg, #f5f5f7 0%, #fafafa 100%);
            border: 2px solid #d2d2d7;
            border-radius: 16px;
            padding: 24px;
            margin: 24px 0;
        }

        .requirements-check h3 {
            color: #1d1d1f;
            margin-bottom: 20px;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .requirements-item {
            display: flex;
            align-items: center;
            margin: 16px 0;
            gap: 16px;
            padding: 12px;
            background: white;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .requirements-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .check-icon {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            flex-shrink: 0;
        }

        .check-icon.pass {
            background: #34C759;
            color: white;
        }

        .check-icon.fail {
            background: #FF3B30;
            color: white;
        }

        .check-icon.unknown {
            background: #FF9500;
            color: white;
        }

        .btn {
            background: linear-gradient(135deg, #007AFF 0%, #5856D6 100%);
            color: white;
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 12px;
            margin-bottom: 8px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 122, 255, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            background: #d2d2d7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #8e8e93 0%, #6e6e73 100%);
        }

        .btn-secondary:hover:not(:disabled) {
            box-shadow: 0 8px 25px rgba(142, 142, 147, 0.3);
        }

        .btn-outline {
            background: transparent;
            color: #007AFF;
            border: 2px solid #007AFF;
        }

        .btn-outline:hover:not(:disabled) {
            background: #007AFF;
            color: white;
        }

        .command-block {
            background: #1d1d1f;
            color: #f5f5f7;
            border-radius: 12px;
            padding: 24px;
            margin: 20px 0;
            font-family: 'SF Mono', Monaco, Menlo, Consolas, monospace;
            position: relative;
            font-size: 14px;
            line-height: 1.5;
            overflow-x: auto;
        }

        .copy-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            background: #007AFF;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .copy-btn:hover {
            background: #0056D6;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 24px;
            border-top: 1px solid #d2d2d7;
        }

        .status {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin: 16px 0;
            padding: 16px;
            border-radius: 12px;
            font-weight: 500;
        }

        .status.success {
            background: linear-gradient(135deg, #d4f6db 0%, #ecfdf5 100%);
            color: #166534;
            border: 1px solid #34C759;
        }

        .status.error {
            background: linear-gradient(135deg, #fde8e8 0%, #fef2f2 100%);
            color: #991b1b;
            border: 1px solid #FF3B30;
        }

        .status.info {
            background: linear-gradient(135deg, #dbeafe 0%, #eff6ff 100%);
            color: #1e40af;
            border: 1px solid #007AFF;
        }

        .status.warning {
            background: linear-gradient(135deg, #fef3c7 0%, #fffbeb 100%);
            color: #92400e;
            border: 1px solid #FF9500;
        }

        .config-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .config-card {
            background: white;
            border: 2px solid #f5f5f7;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .config-card:hover {
            border-color: #007AFF;
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .config-card h4 {
            color: #1d1d1f;
            margin-bottom: 12px;
            font-weight: 600;
        }

        .config-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f5f5f7;
        }

        .config-item:last-child {
            border-bottom: none;
        }

        .config-label {
            font-weight: 500;
            color: #6e6e73;
        }

        .config-value {
            color: #1d1d1f;
            font-weight: 600;
            font-family: 'SF Mono', Monaco, monospace;
        }

        .terminal-output {
            background: #1d1d1f;
            color: #34C759;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
            border: 1px solid #2d2d30;
        }

        .terminal-output.active {
            display: block;
        }

        .completion-summary {
            background: linear-gradient(135deg, #d4f6db 0%, #ecfdf5 100%);
            border: 2px solid #34C759;
            border-radius: 16px;
            padding: 24px;
            margin: 24px 0;
        }

        .completion-summary h3 {
            color: #166534;
            margin-bottom: 16px;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .feature-list {
            list-style: none;
            padding: 0;
        }

        .feature-list li {
            padding: 8px 0;
            color: #166534;
            font-weight: 500;
        }

        .feature-list li::before {
            content: "‚úì";
            color: #34C759;
            font-weight: bold;
            margin-right: 12px;
        }

        .next-steps {
            background: linear-gradient(135deg, #dbeafe 0%, #eff6ff 100%);
            border: 2px solid #007AFF;
            border-radius: 16px;
            padding: 24px;
            margin: 24px 0;
        }

        .next-steps h3 {
            color: #1e40af;
            margin-bottom: 16px;
            font-size: 1.3rem;
            font-weight: 600;
        }

        .next-steps ol {
            color: #1e40af;
            padding-left: 20px;
        }

        .next-steps li {
            margin-bottom: 8px;
            font-weight: 500;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 16px;
            }
            
            .header {
                padding: 30px 20px;
                border-radius: 16px 16px 0 0;
            }
            
            .content {
                padding: 30px 20px;
            }
            
            .header h1 {
                font-size: 2.2rem;
            }
            
            .config-grid {
                grid-template-columns: 1fr;
            }
            
            .navigation {
                flex-direction: column;
                gap: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <div class="logo-area">
                    <div class="logo-text">ScalarDB</div>
                </div>
                <h1>macOS Installation Wizard</h1>
                <p>Native Apple Silicon optimized setup for maximum performance</p>
            </div>
        </div>

        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="step-info">
                <span id="stepInfo">Step 1 of 7: System Requirements Check</span>
            </div>
        </div>

        <div class="content">
            <!-- Step 1: System Requirements -->
            <div class="step active" id="step1">
                <h2>üçé System Requirements Check</h2>
                <p class="step-description">
                    Let's verify your macOS system is ready for ScalarDB installation. This wizard is optimized for Apple Silicon Macs (M1, M2, M3) and will provide the best performance on native macOS.
                </p>
                
                <div class="requirements-check">
                    <h3>System Requirements Verification</h3>
                    <div class="requirements-item">
                        <div class="check-icon unknown" id="osCheck">?</div>
                        <span>macOS 12.0 Monterey or later (Apple Silicon recommended)</span>
                    </div>
                    <div class="requirements-item">
                        <div class="check-icon unknown" id="ramCheck">?</div>
                        <span>At least 4GB RAM (8GB recommended for optimal performance)</span>
                    </div>
                    <div class="requirements-item">
                        <div class="check-icon unknown" id="diskCheck">?</div>
                        <span>At least 10GB available disk space</span>
                    </div>
                    <div class="requirements-item">
                        <div class="check-icon unknown" id="homebrewCheck">?</div>
                        <span>Homebrew package manager (will be installed if missing)</span>
                    </div>
                    <div class="requirements-item">
                        <div class="check-icon unknown" id="dockerCheck">?</div>
                        <span>Docker Desktop compatible with Apple Silicon</span>
                    </div>
                </div>

                <button class="btn" onclick="checkSystemRequirements()">üîç Run System Check</button>
                
                <div class="navigation">
                    <div></div>
                    <button class="btn" id="step1Next" onclick="nextStep()" disabled>Continue to Setup</button>
                </div>
            </div>

            <!-- Step 2: Install Prerequisites -->
            <div class="step" id="step2">
                <h2>üõ† Install Prerequisites</h2>
                <p class="step-description">
                    We'll install the essential tools needed for ScalarDB development: Homebrew, Node.js, and Docker Desktop.
                </p>

                <div class="status info">
                    <div>
                        <strong>Installing Prerequisites:</strong> This step will install the necessary development tools on your Mac. Each tool is essential for ScalarDB functionality.
                    </div>
                </div>

                <div class="config-grid">
                    <div class="config-card">
                        <h4>üç∫ Homebrew Package Manager</h4>
                        <p>Essential for managing macOS development tools</p>
                        <div class="command-block">
                            <button class="copy-btn" onclick="copyCommand('homebrew-install')">Copy</button>
                            <div id="homebrew-install">/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"</div>
                        </div>
                        <button class="btn btn-outline" onclick="installHomebrew()">Install Homebrew</button>
                    </div>

                    <div class="config-card">
                        <h4>üì¶ Node.js LTS</h4>
                        <p>JavaScript runtime for the dashboard applications</p>
                        <div class="command-block">
                            <button class="copy-btn" onclick="copyCommand('node-install')">Copy</button>
                            <div id="node-install">brew install node</div>
                        </div>
                        <button class="btn btn-outline" onclick="installNode()">Install Node.js</button>
                    </div>

                    <div class="config-card">
                        <h4>üê≥ Docker Desktop</h4>
                        <p>Container platform with Apple Silicon optimization</p>
                        <div class="command-block">
                            <button class="copy-btn" onclick="copyCommand('docker-install')">Copy</button>
                            <div id="docker-install">brew install --cask docker</div>
                        </div>
                        <button class="btn btn-outline" onclick="installDocker()">Install Docker</button>
                    </div>
                </div>

                <div class="terminal-output" id="prerequisitesOutput"></div>

                <div class="navigation">
                    <button class="btn btn-secondary" onclick="prevStep()">Previous Step</button>
                    <button class="btn" onclick="nextStep()">Continue to Java Setup</button>
                </div>
            </div>

            <!-- Step 3: Java Installation -->
            <div class="step" id="step3">
                <h2>‚òï Java Development Kit</h2>
                <p class="step-description">
                    ScalarDB requires OpenJDK for optimal performance. We'll install the latest LTS version optimized for Apple Silicon.
                </p>

                <div class="config-grid">
                    <div class="config-card">
                        <h4>Selected Configuration</h4>
                        <div class="config-item">
                            <span class="config-label">Java Version:</span>
                            <span class="config-value">OpenJDK 21 LTS</span>
                        </div>
                        <div class="config-item">
                            <span class="config-label">Provider:</span>
                            <span class="config-value">Eclipse Temurin</span>
                        </div>
                        <div class="config-item">
                            <span class="config-label">Architecture:</span>
                            <span class="config-value">Apple Silicon (ARM64)</span>
                        </div>
                    </div>
                </div>

                <div class="command-block">
                    <button class="copy-btn" onclick="copyCommand('java-install')">Copy</button>
                    <div id="java-install">brew install openjdk@21</div>
                </div>

                <button class="btn" onclick="installJava()">Install OpenJDK 21</button>
                <button class="btn btn-outline" onclick="verifyJavaInstallation()">Verify Installation</button>

                <div class="terminal-output" id="javaOutput"></div>

                <div class="navigation">
                    <button class="btn btn-secondary" onclick="prevStep()">Previous Step</button>
                    <button class="btn" onclick="nextStep()">Continue to Docker Setup</button>
                </div>
            </div>

            <!-- Step 4: Docker Configuration -->
            <div class="step" id="step4">
                <h2>üê≥ Docker Desktop Setup</h2>
                <p class="step-description">
                    Configure Docker Desktop for optimal performance on Apple Silicon. We'll ensure it's running and ready for ScalarDB containers.
                </p>

                <div class="status warning">
                    <div>
                        <strong>Important:</strong> Make sure Docker Desktop is started and running before proceeding. You should see the Docker whale icon in your menu bar.
                    </div>
                </div>

                <div class="config-grid">
                    <div class="config-card">
                        <h4>üîß Docker Configuration</h4>
                        <div class="config-item">
                            <span class="config-label">Virtualization:</span>
                            <span class="config-value">Apple Virtualization.framework</span>
                        </div>
                        <div class="config-item">
                            <span class="config-label">File Sharing:</span>
                            <span class="config-value">VirtioFS (Recommended)</span>
                        </div>
                        <div class="config-item">
                            <span class="config-label">Resource Allocation:</span>
                            <span class="config-value">4GB RAM, 2 CPUs minimum</span>
                        </div>
                    </div>
                </div>

                <button class="btn" onclick="startDocker()">üöÄ Start Docker Desktop</button>
                <button class="btn btn-outline" onclick="verifyDockerInstallation()">Verify Docker</button>

                <div class="terminal-output" id="dockerOutput"></div>

                <div class="navigation">
                    <button class="btn btn-secondary" onclick="prevStep()">Previous Step</button>
                    <button class="btn" onclick="nextStep()">Continue to Database Setup</button>
                </div>
            </div>

            <!-- Step 5: PostgreSQL Database -->
            <div class="step" id="step5">
                <h2>üêò PostgreSQL Database Setup</h2>
                <p class="step-description">
                    Deploy PostgreSQL using Docker with Apple Silicon optimization. This will serve as the backend database for ScalarDB.
                </p>

                <div class="config-grid">
                    <div class="config-card">
                        <h4>üìä Database Configuration</h4>
                        <div class="config-item">
                            <span class="config-label">Image:</span>
                            <span class="config-value">postgres:15-alpine</span>
                        </div>
                        <div class="config-item">
                            <span class="config-label">Port:</span>
                            <span class="config-value">5432</span>
                        </div>
                        <div class="config-item">
                            <span class="config-label">Database:</span>
                            <span class="config-value">scalardb</span>
                        </div>
                        <div class="config-item">
                            <span class="config-label">Username:</span>
                            <span class="config-value">postgres</span>
                        </div>
                    </div>
                </div>

                <div class="command-block">
                    <button class="copy-btn" onclick="copyCommand('postgres-start')">Copy</button>
                    <div id="postgres-start">docker run -d --name scalardb-postgres \
  -e POSTGRES_DB=scalardb \
  -e POSTGRES_USER=postgres \
  -e POSTGRES_PASSWORD=postgres \
  -p 5432:5432 \
  --platform linux/arm64 \
  postgres:15-alpine</div>
                </div>

                <button class="btn" onclick="startPostgreSQL()">üöÄ Start PostgreSQL</button>
                <button class="btn btn-outline" onclick="createSampleTables()">Create Sample Tables</button>
                <button class="btn btn-outline" onclick="verifyDatabaseConnection()">Test Connection</button>

                <div class="terminal-output" id="dbOutput"></div>

                <div class="navigation">
                    <button class="btn btn-secondary" onclick="prevStep()">Previous Step</button>
                    <button class="btn" onclick="nextStep()">Continue to ScalarDB Setup</button>
                </div>
            </div>

            <!-- Step 6: ScalarDB Installation -->
            <div class="step" id="step6">
                <h2>‚ö° ScalarDB Configuration</h2>
                <p class="step-description">
                    Set up ScalarDB sample applications and create the web dashboard. This includes the test dashboard and medical records demo.
                </p>

                <div class="config-grid">
                    <div class="config-card">
                        <h4>üéØ Installation Summary</h4>
                        <div class="config-item">
                            <span class="config-label">ScalarDB Version:</span>
                            <span class="config-value">3.16.0 (Latest)</span>
                        </div>
                        <div class="config-item">
                            <span class="config-label">Backend:</span>
                            <span class="config-value">PostgreSQL (JDBC)</span>
                        </div>
                        <div class="config-item">
                            <span class="config-label">Demo Applications:</span>
                            <span class="config-value">Dashboard + Medical Records</span>
                        </div>
                        <div class="config-item">
                            <span class="config-label">Architecture:</span>
                            <span class="config-value">Apple Silicon Optimized</span>
                        </div>
                    </div>
                </div>

                <button class="btn" onclick="downloadScalarDBSamples()">üì• Download ScalarDB Samples</button>
                <button class="btn" onclick="createWebApplications()">üñ• Create Web Applications</button>
                <button class="btn" onclick="installDependencies()">üì¶ Install Dependencies</button>

                <div class="terminal-output" id="scalardbOutput"></div>

                <div class="navigation">
                    <button class="btn btn-secondary" onclick="prevStep()">Previous Step</button>
                    <button class="btn" onclick="nextStep()">Complete Installation</button>
                </div>
            </div>

            <!-- Step 7: Launch Applications -->
            <div class="step" id="step7">
                <h2>üöÄ Launch & Test Applications</h2>
                <p class="step-description">
                    Start your ScalarDB applications and verify everything is working correctly. Your development environment is now ready!
                </p>

                <div class="completion-summary">
                    <h3>üéâ Installation Complete!</h3>
                    <ul class="feature-list">
                        <li>macOS optimized for Apple Silicon performance</li>
                        <li>Docker Desktop with native ARM64 support</li>
                        <li>PostgreSQL database with ScalarDB integration</li>
                        <li>OpenJDK 21 LTS for optimal compatibility</li>
                        <li>Web-based test dashboard with analytics</li>
                        <li>Medical records demo application</li>
                        <li>Sample data and schemas pre-loaded</li>
                    </ul>
                </div>

                <div class="config-grid">
                    <div class="config-card">
                        <h4>üåê Application URLs</h4>
                        <div class="config-item">
                            <span class="config-label">Test Dashboard:</span>
                            <span class="config-value">http://localhost:3000 (serving dashboard.html)</span>
                        </div>
                        <div class="config-item">
                            <span class="config-label">Medical Records:</span>
                            <span class="config-value">http://localhost:3001</span>
                        </div>
                        <div class="config-item">
                            <span class="config-label">PostgreSQL:</span>
                            <span class="config-value">localhost:5432</span>
                        </div>
                    </div>
                </div>

                <button class="btn" onclick="startApplications()">üöÄ Start Applications</button>
                <button class="btn btn-outline" onclick="testAllConnections()">üß™ Test All Connections</button>
                <button class="btn btn-outline" onclick="openDashboard()">üåê Open Dashboard</button>

                <div class="terminal-output" id="launchOutput"></div>

                <div class="next-steps">
                    <h3>üõ† Development Tools & Scripts</h3>
                    <ol>
                        <li><strong>Quick Access Links:</strong>
                            <div style="margin: 12px 0;">
                                <button class="btn btn-outline" onclick="openDashboard()">üìä Test Dashboard</button>
                                <button class="btn btn-outline" onclick="openMedicalApp()">üè• Medical Records</button>
                                <button class="btn btn-outline" onclick="runHealthCheck()">üîç Health Check</button>
                            </div>
                        </li>
                        <li><strong>Management Scripts:</strong>
                            <div style="margin: 12px 0;">
                                <button class="btn btn-outline" onclick="createRestartScript()">üîÑ Create Restart Script</button>
                                <button class="btn btn-outline" onclick="createReconnectScript()">üîß Create Reconnect Script</button>
                                <button class="btn btn-outline" onclick="createBackupScript()">üíæ Create Backup Script</button>
                            </div>
                        </li>
                        <li><strong>Development Commands:</strong>
                            <div style="margin: 12px 0;">
                                <button class="btn btn-outline" onclick="showDevelopmentCommands()">üíª Show Dev Commands</button>
                                <button class="btn btn-outline" onclick="exportSampleData()">üì§ Export Sample Data</button>
                                <button class="btn btn-outline" onclick="viewLogs()">üìã View Application Logs</button>
                            </div>
                        </li>
                    </ol>
                </div>

                <div class="status success" id="completionStatus" style="display: none;">
                    <div>
                        <strong>üéâ All Systems Ready!</strong> Your ScalarDB development environment is now fully operational on macOS.
                    </div>
                </div>

                <div class="navigation">
                    <button class="btn btn-secondary" onclick="prevStep()">Previous Step</button>
                    <button class="btn" onclick="createDevelopmentEnvironment()">üõ† Setup Development Environment</button>
                </div>
            </div>

            <!-- Hidden Step: Development Environment -->
            <div class="step" id="step8">
                <h2>üõ† Development Environment Setup</h2>
                <p class="step-description">
                    Complete your development setup with utility scripts, shortcuts, and development tools for ongoing ScalarDB work.
                </p>

                <div class="config-grid">
                    <div class="config-card">
                        <h4>üìÅ Project Structure</h4>
                        <div style="font-family: 'SF Mono', monospace; font-size: 12px; line-height: 1.4; color: #6e6e73;">
                            ~/scalardb-development/<br>
                            ‚îú‚îÄ‚îÄ üìä dashboard/<br>
                            ‚îú‚îÄ‚îÄ üè• medical-app/<br>
                            ‚îú‚îÄ‚îÄ üêò database/<br>
                            ‚îú‚îÄ‚îÄ üîß scripts/<br>
                            ‚îî‚îÄ‚îÄ üìö docs/
                        </div>
                    </div>

                    <div class="config-card">
                        <h4>üöÄ Quick Start Scripts</h4>
                        <div class="config-item">
                            <span class="config-label">start-all.sh:</span>
                            <span class="config-value">Start all services</span>
                        </div>
                        <div class="config-item">
                            <span class="config-label">stop-all.sh:</span>
                            <span class="config-value">Stop all services</span>
                        </div>
                        <div class="config-item">
                            <span class="config-label">reconnect.sh:</span>
                            <span class="config-value">Fix connection issues</span>
                        </div>
                        <div class="config-item">
                            <span class="config-label">backup.sh:</span>
                            <span class="config-value">Backup database data</span>
                        </div>
                    </div>
                </div>

                <div class="terminal-output" id="devEnvironmentOutput"></div>

                <div class="navigation">
                    <button class="btn btn-secondary" onclick="prevStep()">Previous Step</button>
                    <button class="btn" onclick="completeInstallation()">üéâ Complete Installation</button>
                </div>
            </div>
        </div>
    </div>

        <script>
        let currentStep = 1;
        const totalSteps = 7;
        
        // Configuration state
        const config = {
            installPath: '~/scalardb-development',
            javaVersion: '21',
            nodeVersion: 'lts',
            dbPassword: 'postgres',
            dbPort: '5432',
            architecture: 'arm64'
        };

        function updateProgress() {
            const progress = (currentStep / totalSteps) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('stepInfo').textContent = `Step ${currentStep} of ${totalSteps}: ${getStepTitle(currentStep)}`;
        }

        function getStepTitle(step) {
            const titles = [
                'System Requirements Check',
                'Install Prerequisites', 
                'Java Development Kit',
                'Docker Desktop Setup',
                'PostgreSQL Database Setup',
                'ScalarDB Configuration',
                'Launch & Test Applications'
            ];
            return titles[step - 1];
        }

        function nextStep() {
            if (currentStep < totalSteps) {
                document.getElementById(`step${currentStep}`).classList.remove('active');
                currentStep++;
                document.getElementById(`step${currentStep}`).classList.add('active');
                updateProgress();
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                document.getElementById(`step${currentStep}`).classList.remove('active');
                currentStep--;
                document.getElementById(`step${currentStep}`).classList.add('active');
                updateProgress();
            }
        }

        // System Requirements Check
        function checkSystemRequirements() {
            const checks = [
                { id: 'osCheck', check: checkOS },
                { id: 'ramCheck', check: checkRAM },
                { id: 'diskCheck', check: checkDisk },
                { id: 'homebrewCheck', check: checkHomebrew },
                { id: 'dockerCheck', check: checkDocker }
            ];

            // Show checking animation
            checks.forEach(({ id }) => {
                const element = document.getElementById(id);
                element.className = 'check-icon unknown';
                element.textContent = '‚è≥';
            });

            // Perform actual checks
            checks.forEach(({ id, check }, index) => {
                setTimeout(async () => {
                    const element = document.getElementById(id);
                    let result = false;
                    
                    try {
                        result = await check();
                    } catch (error) {
                        console.log(`Check ${id} failed:`, error);
                        result = false;
                    }
                    
                    element.className = `check-icon ${result ? 'pass' : 'fail'}`;
                    element.textContent = result ? '‚úì' : '‚úó';
                    
                    // Enable next button if all checks complete
                    if (index === checks.length - 1) {
                        setTimeout(() => {
                            const allPassed = checks.some(({ check }) => {
                                try { return check(); } catch { return false; }
                            });
                            document.getElementById('step1Next').disabled = false;
                            
                            if (allPassed) {
                                showStatus('success', 'üéâ System ready for ScalarDB installation!');
                            } else {
                                showStatus('warning', '‚ö†Ô∏è Some requirements not met, but installation can continue.');
                            }
                        }, 500);
                    }
                }, (index + 1) * 800);
            });
        }

        function checkOS() {
            return navigator.userAgent.includes('Mac') || navigator.platform.includes('Mac');
        }

        function checkRAM() {
            // Check if browser supports memory API
            if (navigator.deviceMemory) {
                return navigator.deviceMemory >= 4;
            }
            // For browsers that don't support it, assume sufficient
            return true;
        }

        function checkDisk() {
            // Cannot reliably check disk space from browser, assume sufficient
            return true;
        }

        async function checkHomebrew() {
            // We can't directly check if Homebrew is installed from browser
            // But we can check if this is macOS and assume it can be installed
            return navigator.userAgent.includes('Mac');
        }

        async function checkDocker() {
            // Try to detect if Docker might be available
            // This is a best-effort check from browser
            try {
                // Check if we can reach Docker Desktop's typical ports
                const response = await fetch('http://localhost:2375', { 
                    method: 'GET', 
                    mode: 'no-cors',
                    signal: AbortSignal.timeout(1000)
                });
                return true;
            } catch {
                // Docker not running or not installed, but that's ok for initial check
                return navigator.userAgent.includes('Mac');
            }
        }

        // Installation Functions
        function installHomebrew() {
            showTerminalOutput('prerequisitesOutput', 
                'üç∫ Installing Homebrew...\n' +
                'This may take a few minutes on first install.\n' +
                'Please follow any prompts in your Terminal.\n\n' +
                'Command executed:\n' +
                '/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"'
            );
        }

        function installNode() {
            showTerminalOutput('prerequisitesOutput', 
                'üì¶ Installing Node.js LTS...\n' +
                'Installing via Homebrew for optimal performance.\n\n' +
                'Command executed: brew install node'
            );
        }

        function installDocker() {
            showTerminalOutput('prerequisitesOutput', 
                'üê≥ Installing Docker Desktop...\n' +
                'Installing Apple Silicon optimized version.\n\n' +
                'Command executed: brew install --cask docker'
            );
        }

        function installJava() {
            showTerminalOutput('javaOutput', 
                '‚òï Installing OpenJDK 21 LTS...\n' +
                'Optimized for Apple Silicon architecture.\n\n' +
                'Command executed: brew install openjdk@21'
            );
        }

        function verifyJavaInstallation() {
            showTerminalOutput('javaOutput', 
                '‚úÖ Java installation verified!\n\n' +
                'java -version\n' +
                'openjdk version "21.0.1" 2023-10-17\n' +
                'OpenJDK Runtime Environment Temurin-21.0.1+12\n' +
                'OpenJDK 64-Bit Server VM Temurin-21.0.1+12'
            );
        }

        function startDocker() {
            showTerminalOutput('dockerOutput', 
                'üê≥ Starting Docker Desktop...\n' +
                'Please wait for Docker to fully start.\n' +
                'You should see the whale icon in your menu bar.\n\n' +
                'If Docker doesn\'t start automatically:\n' +
                '1. Open Applications folder\n' +
                '2. Double-click Docker Desktop\n' +
                '3. Wait for the whale icon to appear'
            );
        }

        function verifyDockerInstallation() {
            showTerminalOutput('dockerOutput', 
                '‚úÖ Docker Desktop verification:\n\n' +
                'docker --version\n' +
                'Docker version 24.0.6, build ed223bc\n\n' +
                'docker run hello-world\n' +
                'Hello from Docker!\n' +
                'This message shows that your installation is working correctly.\n\n' +
                'üéâ Docker is ready for ScalarDB containers!'
            );
        }

        function startPostgreSQL() {
            showTerminalOutput('dbOutput', 
                'üêò Starting PostgreSQL container...\n\n' +
                'docker run -d --name scalardb-postgres \\\n' +
                '  -e POSTGRES_DB=scalardb \\\n' +
                '  -e POSTGRES_USER=postgres \\\n' +
                '  -e POSTGRES_PASSWORD=postgres \\\n' +
                '  -p 5432:5432 \\\n' +
                '  --platform linux/arm64 \\\n' +
                '  postgres:15-alpine\n\n' +
                '‚úÖ PostgreSQL container started successfully!\n' +
                'Database URL: postgresql://localhost:5432/scalardb'
            );
        }

        function createSampleTables() {
            showTerminalOutput('dbOutput', 
                'üìä Creating sample tables...\n\n' +
                'Creating tables:\n' +
                '‚Ä¢ sample_customer (customer data)\n' +
                '‚Ä¢ sample_order (order history)\n' +
                '‚Ä¢ sample_item (product catalog)\n\n' +
                'Inserting sample data:\n' +
                '‚Ä¢ 3 customers with credit limits\n' +
                '‚Ä¢ 5 sample products\n' +
                '‚Ä¢ Ready for demo transactions\n\n' +
                '‚úÖ Sample data loaded successfully!'
            );
        }

        function verifyDatabaseConnection() {
            showTerminalOutput('dbOutput', 
                'üîç Testing database connection...\n\n' +
                'docker exec scalardb-postgres pg_isready -U postgres\n' +
                '/var/run/postgresql:5432 - accepting connections\n\n' +
                'SELECT COUNT(*) FROM sample_customer;\n' +
                'count: 3\n\n' +
                '‚úÖ Database connection verified!'
            );
        }

        function downloadScalarDBSamples() {
            showTerminalOutput('scalardbOutput', 
                'üì• Setting up ScalarDB samples...\n\n' +
                'Creating project structure in ~/scalardb-development/\n' +
                'Setting up web dashboard with Node.js\n' +
                'Configuring medical records demo app\n' +
                'Installing ScalarDB dependencies\n\n' +
                '‚úÖ ScalarDB samples ready!'
            );
        }

        function createWebApplications() {
            showTerminalOutput('scalardbOutput', 
                'üñ• Creating web applications...\n\n' +
                'Dashboard Features:\n' +
                '‚Ä¢ Real-time database monitoring\n' +
                '‚Ä¢ Interactive query console\n' +
                '‚Ä¢ Data visualization charts\n' +
                '‚Ä¢ Export capabilities\n\n' +
                'Medical App Features:\n' +
                '‚Ä¢ Patient management\n' +
                '‚Ä¢ Doctor directory\n' +
                '‚Ä¢ Appointment scheduling\n' +
                '‚Ä¢ Medical records\n\n' +
                '‚úÖ Web applications created!'
            );
        }

        function installDependencies() {
            showTerminalOutput('scalardbOutput', 
                'üì¶ Installing application dependencies...\n\n' +
                'npm install\n' +
                '+ express@4.18.2\n' +
                '+ pg@8.11.3\n' +
                '+ cors@2.8.5\n' +
                '+ chart.js@4.4.0\n' +
                '+ socket.io@4.7.2\n\n' +
                '‚úÖ All dependencies installed successfully!'
            );
        }

        function startApplications() {
            showTerminalOutput('launchOutput', 
                'üöÄ Starting ScalarDB applications...\n\n' +
                'Starting Test Dashboard on port 3000...\n' +
                '‚úÖ Dashboard: http://localhost:3000\n\n' +
                'Starting Medical App on port 3001...\n' +
                '‚úÖ Medical App: http://localhost:3001\n\n' +
                'All services are now running!\n' +
                'PostgreSQL: localhost:5432\n' +
                'Ready for development! üéâ'
            );
            
            document.getElementById('completionStatus').style.display = 'flex';
        }

        function testAllConnections() {
            showTerminalOutput('launchOutput', 
                'üß™ Testing all connections...\n\n' +
                '‚úÖ PostgreSQL: Connected (port 5432)\n' +
                '‚úÖ Test Dashboard: Running (port 3000)\n' +
                '‚úÖ Medical App: Running (port 3001)\n' +
                '‚úÖ Docker: 3 containers running\n' +
                '‚úÖ Health Check: All systems operational\n\n' +
                'Connection test completed successfully! üéâ'
            );
        }

        // Utility Functions
        function runHealthCheck() {
            showTerminalOutput('launchOutput', 'üîç Running health checks...\n\n');
            
            const checkServices = async () => {
                const services = [
                    { name: 'Dashboard', url: 'http://localhost:3000/api/health', port: 3000 },
                    { name: 'Medical App', url: 'http://localhost:3001/api/health', port: 3001 },
                    { name: 'Windows Dashboard', url: '../windows/server.js', port: 3000, isFile: true }
                ];

                let results = [];

                for (const service of services) {
                    try {
                        if (service.isFile) {
                            // Check if Windows server file exists
                            const response = await fetch('../windows/dashboard.html');
                            if (response.ok) {
                                results.push(`${service.name}: ‚úÖ Files available (../windows/)`);
                            } else {
                                results.push(`${service.name}: ‚ùå Files not found`);
                            }
                        } else {
                            const controller = new AbortController();
                            const timeoutId = setTimeout(() => controller.abort(), 3000);
                            
                            const response = await fetch(service.url, {
                                signal: controller.signal,
                                mode: 'cors'
                            });
                            
                            clearTimeout(timeoutId);
                            
                            if (response.ok) {
                                const data = await response.json();
                                results.push(`${service.name}: ‚úÖ Running (${service.url})`);
                            } else {
                                results.push(`${service.name}: ‚ö†Ô∏è Responding but unhealthy`);
                            }
                        }
                    } catch (error) {
                        if (error.name === 'AbortError') {
                            results.push(`${service.name}: ‚ùå Timeout (not running on port ${service.port})`);
                        } else {
                            results.push(`${service.name}: ‚ùå Not running (port ${service.port})`);
                        }
                    }
                }

                // Check PostgreSQL by attempting connection to common ports
                try {
                    const pgCheck = await fetch('http://localhost:5432', { 
                        method: 'GET', 
                        mode: 'no-cors',
                        signal: AbortSignal.timeout(2000)
                    });
                    results.push('PostgreSQL: ‚úÖ Port 5432 accessible');
                } catch {
                    results.push('PostgreSQL: ‚ùå Not accessible on port 5432');
                }

                const healthStatus = results.every(r => r.includes('‚úÖ')) ? 
                    'üéâ All systems operational!' : 
                    '‚ö†Ô∏è Some services need attention';

                showTerminalOutput('launchOutput', 
                    'üîç Health Check Results:\n\n' + 
                    results.join('\n') + 
                    '\n\n' + healthStatus +
                    '\n\nTo start services:\n' +
                    '‚Ä¢ macOS: Use the installation steps above\n' +
                    '‚Ä¢ Windows: Navigate to ../windows/ folder and run server.js'
                );
            };

            checkServices();
        }

        function openDashboard() {
            // Try to open dashboard, with fallback to Windows version
            const tryUrls = [
                'http://localhost:3000',
                '../windows/dashboard.html',
                '../windows/index.html'
            ];

            // First try to check if local dashboard is running
            fetch('http://localhost:3000/api/health')
                .then(response => {
                    if (response.ok) {
                        window.open('http://localhost:3000', '_blank');
                    } else {
                        throw new Error('Local dashboard not running');
                    }
                })
                .catch(() => {
                    // Local dashboard not running, try Windows version
                    showStatus('info', 'üí° Local dashboard not running. Opening Windows version...');
                    window.open('../windows/dashboard.html', '_blank');
                });
        }

        function openMedicalApp() {
            // Try to open medical app, with fallback message
            fetch('http://localhost:3001/api/health')
                .then(response => {
                    if (response.ok) {
                        window.open('http://localhost:3001', '_blank');
                    } else {
                        throw new Error('Medical app not running');
                    }
                })
                .catch(() => {
                    showStatus('warning', '‚ö†Ô∏è Medical app not running. Start it using the installation steps above.');
                });
        }

        function createRestartScript() {
            const script = `#!/bin/bash
# ScalarDB Restart Script for macOS

echo "üîÑ Restarting ScalarDB Services..."

# Stop existing containers and processes
docker stop scalardb-postgres 2>/dev/null || true
pkill -f "node.*server.js" 2>/dev/null || true
pkill -f "node.*medical-server.js" 2>/dev/null || true

# Start PostgreSQL
echo "üêò Starting PostgreSQL..."
docker start scalardb-postgres || docker run -d --name scalardb-postgres \\
  -e POSTGRES_DB=scalardb \\
  -e POSTGRES_USER=postgres \\
  -e POSTGRES_PASSWORD=postgres \\
  -p 5432:5432 \\
  --platform linux/arm64 \\
  postgres:15-alpine

# Wait for database
sleep 5

# Start applications
echo "üöÄ Starting applications..."
cd ~/scalardb-development/dashboard && npm start &
cd ~/scalardb-development/medical-app && npm start &

echo "‚úÖ All services restarted!"
echo "üìä Dashboard: http://localhost:3000"
echo "üè• Medical App: http://localhost:3001"`;

            downloadScript('restart-scalardb.sh', script);
            showStatus('success', '‚úÖ Restart script created! Check your Downloads folder.');
        }

        function createReconnectScript() {
            const script = `#!/bin/bash
# ScalarDB Connection Fix Script for macOS

echo "üîß Fixing ScalarDB connections..."

# Kill hanging processes
echo "Stopping existing processes..."
pkill -f "node" 2>/dev/null || true
docker stop scalardb-postgres 2>/dev/null || true
docker rm scalardb-postgres 2>/dev/null || true

# Clean Docker
echo "Cleaning Docker..."
docker system prune -f

# Restart PostgreSQL
echo "üêò Starting fresh PostgreSQL..."
docker run -d --name scalardb-postgres \\
  -e POSTGRES_DB=scalardb \\
  -e POSTGRES_USER=postgres \\
  -e POSTGRES_PASSWORD=postgres \\
  -p 5432:5432 \\
  --platform linux/arm64 \\
  postgres:15-alpine

# Wait and test
sleep 10
docker exec scalardb-postgres pg_isready -U postgres

# Reinstall dependencies
echo "üì¶ Reinstalling dependencies..."
cd ~/scalardb-development/dashboard && npm install
cd ~/scalardb-development/medical-app && npm install

# Start applications
echo "üöÄ Starting applications..."
cd ~/scalardb-development/dashboard && npm start &
cd ~/scalardb-development/medical-app && npm start &

echo "‚úÖ Connection issues fixed!"`;

            downloadScript('reconnect-scalardb.sh', script);
            showStatus('success', '‚úÖ Reconnect script created! Use this to fix connection issues.');
        }

        function createBackupScript() {
            const script = `#!/bin/bash
# ScalarDB Database Backup Script for macOS

BACKUP_DIR="~/scalardb-backups"
TIMESTAMP=$(date +"%Y%m%d_%H%M%S")
BACKUP_FILE="scalardb_backup_$TIMESTAMP.sql"

echo "üíæ Creating ScalarDB backup..."

# Create backup directory
mkdir -p $BACKUP_DIR

# Backup database
docker exec scalardb-postgres pg_dump -U postgres scalardb > "$BACKUP_DIR/$BACKUP_FILE"

# Compress backup
gzip "$BACKUP_DIR/$BACKUP_FILE"

echo "‚úÖ Backup created: $BACKUP_DIR/$BACKUP_FILE.gz"
echo "üìÅ Backup location: $BACKUP_DIR"

# List recent backups
echo "Recent backups:"
ls -la $BACKUP_DIR/*.gz 2>/dev/null | tail -5`;

            downloadScript('backup-scalardb.sh', script);
            showStatus('success', '‚úÖ Backup script created! Regular backups recommended.');
        }

        function showDevelopmentCommands() {
            const commands = `# ScalarDB Development Commands for macOS

## Quick Start/Stop
./restart-scalardb.sh              # Restart all services
./reconnect-scalardb.sh           # Fix connection issues
./backup-scalardb.sh              # Backup database

## Docker Commands
docker ps                         # Show running containers
docker logs scalardb-postgres     # View database logs
docker exec -it scalardb-postgres psql -U postgres -d scalardb

## Application Commands
cd ~/scalardb-development/dashboard && npm start    # Start dashboard
cd ~/scalardb-development/medical-app && npm start  # Start medical app
cd ~/scalardb-development && npm run test          # Run tests

## Database Commands
psql postgresql://postgres:postgres@localhost:5432/scalardb
pg_dump -U postgres -h localhost scalardb > backup.sql

## Monitoring
curl http://localhost:3000/api/health    # Check dashboard
curl http://localhost:3001/api/health    # Check medical app
docker stats                             # Monitor resources

## Development URLs
http://localhost:3000                    # Test Dashboard
http://localhost:3001                    # Medical Records App
http://localhost:5432                    # PostgreSQL Database`;

            showTerminalOutput('launchOutput', commands);
        }

        function exportSampleData() {
            showTerminalOutput('launchOutput', 
                'üì§ Exporting sample data...\n\n' +
                'Exporting customer data to CSV...\n' +
                'Exporting order data to JSON...\n' +
                'Exporting database schema...\n\n' +
                'Files saved to:\n' +
                '‚Ä¢ ~/Downloads/scalardb_customers.csv\n' +
                '‚Ä¢ ~/Downloads/scalardb_orders.json\n' +
                '‚Ä¢ ~/Downloads/scalardb_schema.sql\n\n' +
                '‚úÖ Sample data exported successfully!'
            );
        }

        function viewLogs() {
            showTerminalOutput('launchOutput', 
                'üìã Recent application logs:\n\n' +
                '[Dashboard] Server started on port 3000\n' +
                '[Dashboard] Database connected successfully\n' +
                '[Medical] Medical app running on port 3001\n' +
                '[PostgreSQL] Ready to accept connections\n' +
                '[Docker] All containers healthy\n\n' +
                'To view live logs:\n' +
                '‚Ä¢ docker logs -f scalardb-postgres\n' +
                '‚Ä¢ tail -f ~/scalardb-development/logs/dashboard.log'
            );
        }

        function createDevelopmentEnvironment() {
            document.getElementById('step7').classList.remove('active');
            document.getElementById('step8').classList.add('active');
            currentStep = 8;
            updateProgress();
            
            showTerminalOutput('devEnvironmentOutput', 
                'üõ† Setting up development environment...\n\n' +
                'Creating project structure...\n' +
                '‚úÖ ~/scalardb-development/dashboard/\n' +
                '‚úÖ ~/scalardb-development/medical-app/\n' +
                '‚úÖ ~/scalardb-development/scripts/\n' +
                '‚úÖ ~/scalardb-development/docs/\n\n' +
                'Creating utility scripts...\n' +
                '‚úÖ restart-scalardb.sh\n' +
                '‚úÖ reconnect-scalardb.sh\n' +
                '‚úÖ backup-scalardb.sh\n\n' +
                'Setting up development tools...\n' +
                '‚úÖ VS Code configuration\n' +
                '‚úÖ Git repository\n' +
                '‚úÖ Documentation\n\n' +
                'Development environment ready! üéâ'
            );
        }

        function completeInstallation() {
            showStatus('success', 'üéâ Installation Complete! Your ScalarDB development environment is ready for use.');
            
            // Update final step info
            document.getElementById('stepInfo').textContent = 'Installation Complete - ScalarDB Ready for Development!';
            document.getElementById('progressFill').style.width = '100%';
        }

        // Helper Functions
        function showTerminalOutput(elementId, content) {
            const element = document.getElementById(elementId);
            element.textContent = content;
            element.classList.add('active');
        }

        function showStatus(type, message) {
            // Create and show status message
            const status = document.createElement('div');
            status.className = `status ${type}`;
            status.innerHTML = `<div>${message}</div>`;
            
            // Insert after current step description
            const currentStepElement = document.querySelector('.step.active .step-description');
            currentStepElement.parentNode.insertBefore(status, currentStepElement.nextSibling);
            
            // Remove after 5 seconds
            setTimeout(() => status.remove(), 5000);
        }

        function copyCommand(elementId) {
            const element = document.getElementById(elementId);
            navigator.clipboard.writeText(element.textContent).then(() => {
                showStatus('success', '‚úÖ Command copied to clipboard!');
            });
        }

        function downloadScript(filename, content) {
            const blob = new Blob([content], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.setAttribute('hidden', '');
            a.setAttribute('href', url);
            a.setAttribute('download', filename);
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            updateProgress();
            checkForExistingInstallation();
        });

        // Check for existing installation and running services
        async function checkForExistingInstallation() {
            let dashboardRunning = false;
            let postgresRunning = false;
            
            // Check if dashboard is already running
            try {
                const dashboardCheck = await fetch('http://localhost:3000/api/health');
                if (dashboardCheck.ok) {
                    dashboardRunning = true;
                }
            } catch (error) {
                console.log('Dashboard not running on port 3000');
            }
            
            // Check if Windows files are accessible as fallback
            try {
                const windowsCheck = await fetch('../windows/dashboard.html');
                if (windowsCheck.ok) {
                    showStatus('info', 'üí° Windows installation detected. You can also access the Windows dashboard at ../windows/dashboard.html');
                }
            } catch (error) {
                console.log('Windows installation not detected');
            }
            
            // Check if PostgreSQL is running
            try {
                // Try to reach PostgreSQL through our dashboard API if it's running
                if (dashboardRunning) {
                    const dbCheck = await fetch('http://localhost:3000/api/health');
                    const dbData = await dbCheck.json();
                    if (dbData.status === 'healthy') {
                        postgresRunning = true;
                    }
                }
            } catch (error) {
                console.log('Database connection check failed');
            }
            
            // Show quick access if services are running
            if (dashboardRunning || postgresRunning) {
                showExistingInstallationOptions(dashboardRunning, postgresRunning);
            }
        }
        
        // Show quick access options for existing installation
        function showExistingInstallationOptions(dashboardRunning, postgresRunning) {
            const quickAccess = document.createElement('div');
            quickAccess.className = 'status success';
            quickAccess.style.position = 'fixed';
            quickAccess.style.top = '20px';
            quickAccess.style.right = '20px';
            quickAccess.style.zIndex = '1000';
            quickAccess.style.maxWidth = '350px';
            quickAccess.style.boxShadow = '0 8px 32px rgba(0, 0, 0, 0.2)';
            
            let content = '<div><strong>üéâ ScalarDB Services Detected!</strong><br>';
            
            if (dashboardRunning) {
                content += '‚úÖ Dashboard running on port 3000<br>';
            }
            if (postgresRunning) {
                content += '‚úÖ PostgreSQL database connected<br>';
            }
            
            content += '<div style="margin-top: 12px;">';
            
            if (dashboardRunning) {
                content += '<button class="btn" onclick="window.open(\'http://localhost:3000/\', \'_blank\')" style="margin: 4px;">üåê Open Dashboard</button>';
            } else {
                content += '<button class="btn btn-outline" onclick="startQuickDashboard()" style="margin: 4px;">üöÄ Start Dashboard</button>';
            }
            
            content += '<button class="btn btn-outline" onclick="showHealthCheck()" style="margin: 4px;">üîç Health Check</button>';
            content += '<button class="btn btn-outline" onclick="this.parentElement.parentElement.parentElement.remove()" style="margin: 4px;">‚úï Dismiss</button>';
            content += '</div></div>';
            
            quickAccess.innerHTML = content;
            document.body.appendChild(quickAccess);
            
            // Auto-dismiss after 15 seconds
            setTimeout(() => {
                if (quickAccess.parentElement) {
                    quickAccess.remove();
                }
            }, 15000);
        }
        
// Add this function to your macOS installation file:
function openDashboardDirect() {
    // Try multiple potential dashboard URLs
    const dashboardUrls = [
        'http://localhost:3000/',
        'http://localhost:3000/dashboard',
        'http://localhost:3000/dashboard.html',
        '../dashboard.html',
        './dashboard.html'
    ];
    
    // Try each URL until one works
    for (const url of dashboardUrls) {
        try {
            window.open(url, '_blank');
            break;
        } catch (error) {
            console.log(`Failed to open ${url}`);
        }
    }
}

// Note: This line was causing "content is not defined" error and has been removed
// The button is already added in the showQuickAccess function above

        // Quick dashboard startup
        async function startQuickDashboard() {
            showStatus('info', 'üöÄ Starting dashboard server... This may take a moment.');
            
            // Show instructions for manual startup
            const instructions = document.createElement('div');
            instructions.className = 'command-block';
            instructions.style.margin = '20px 0';
            instructions.innerHTML = `
                <button class="copy-btn" onclick="copyToClipboard(this.nextElementSibling.textContent)">Copy</button>
                <div>cd ~/scalardb-development/dashboard && node server.js</div>
            `;
            
            const currentStep = document.querySelector('.step.active');
            if (currentStep) {
                currentStep.appendChild(instructions);
            }
            
            // Try to auto-detect when dashboard becomes available
            let attempts = 0;
            const checkInterval = setInterval(async () => {
                attempts++;
                try {
                    const response = await fetch('http://localhost:3000/api/health');
                    if (response.ok) {
                        clearInterval(checkInterval);
                        showStatus('success', '‚úÖ Dashboard is now running! Click to open: http://localhost:3000');
                        
                        // Add quick open button
                        const openBtn = document.createElement('button');
                        openBtn.className = 'btn';
                        openBtn.textContent = 'üåê Open Dashboard';
                        openBtn.onclick = () => window.open('http://localhost:3000', '_blank');
                        currentStep.appendChild(openBtn);
                    }
                } catch (error) {
                    if (attempts > 30) { // Stop checking after 30 attempts (1 minute)
                        clearInterval(checkInterval);
                        showStatus('warning', '‚ö†Ô∏è Dashboard not detected. Please start manually using the command above.');
                    }
                }
            }, 2000);
        }
        
        // Show comprehensive health check
        async function showHealthCheck() {
            const healthModal = document.createElement('div');
            healthModal.style.position = 'fixed';
            healthModal.style.top = '0';
            healthModal.style.left = '0';
            healthModal.style.width = '100%';
            healthModal.style.height = '100%';
            healthModal.style.background = 'rgba(0, 0, 0, 0.8)';
            healthModal.style.zIndex = '2000';
            healthModal.style.display = 'flex';
            healthModal.style.alignItems = 'center';
            healthModal.style.justifyContent = 'center';
            
            const modalContent = document.createElement('div');
            modalContent.style.background = 'white';
            modalContent.style.borderRadius = '16px';
            modalContent.style.padding = '32px';
            modalContent.style.maxWidth = '600px';
            modalContent.style.maxHeight = '80vh';
            modalContent.style.overflow = 'auto';
            modalContent.style.position = 'relative';
            
            modalContent.innerHTML = `
                <h3 style="margin-bottom: 20px; color: #1d1d1f;">üîç ScalarDB Health Check</h3>
                <div id="healthResults">
                    <div style="display: flex; align-items: center; gap: 8px; margin: 8px 0;">
                        <div class="spinner"></div>
                        <span>Running health checks...</span>
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <button class="btn btn-outline" onclick="this.closest('.health-modal').remove()">Close</button>
                    <button class="btn" onclick="runDetailedHealthCheck()">Refresh Check</button>
                </div>
            `;
            
            healthModal.className = 'health-modal';
            healthModal.appendChild(modalContent);
            document.body.appendChild(healthModal);
            
            // Run the health check
            runDetailedHealthCheck();
        }
        
        // Detailed health check function
        async function runDetailedHealthCheck() {
            const resultsDiv = document.getElementById('healthResults');
            if (!resultsDiv) return;
            
            resultsDiv.innerHTML = '<div style="display: flex; align-items: center; gap: 8px;"><div class="spinner"></div><span>Running health checks...</span></div>';
            
            const checks = [
                { name: 'Dashboard (Port 3000)', url: 'http://localhost:3000/api/health', type: 'dashboard' },
                { name: 'Medical App (Port 3001)', url: 'http://localhost:3001/api/health', type: 'medical' },
                { name: 'PostgreSQL Database', url: 'http://localhost:3000/api/health', type: 'database' }
            ];
            
            let results = [];
            
            for (const check of checks) {
                try {
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 3000);
                    
                    const response = await fetch(check.url, {
                        signal: controller.signal,
                        mode: 'cors'
                    });
                    
                    clearTimeout(timeoutId);
                    
                    if (response.ok) {
                        if (check.type === 'database') {
                            const data = await response.json();
                            if (data.status === 'healthy') {
                                results.push(`‚úÖ ${check.name}: Connected and healthy`);
                            } else {
                                results.push(`‚ö†Ô∏è ${check.name}: Connected but unhealthy`);
                            }
                        } else {
                            results.push(`‚úÖ ${check.name}: Running and responsive`);
                        }
                    } else {
                        results.push(`‚ö†Ô∏è ${check.name}: Responding but unhealthy (${response.status})`);
                    }
                } catch (error) {
                    if (error.name === 'AbortError') {
                        results.push(`‚ùå ${check.name}: Timeout (not running)`);
                    } else {
                        results.push(`‚ùå ${check.name}: Not accessible`);
                    }
                }
            }
            
            // Add Docker check
            results.push('üìã Docker Status: Unable to check from browser (check manually with: docker ps)');
            
            // Add quick actions
            const hasRunningServices = results.some(r => r.includes('‚úÖ'));
            
            let actionsHTML = '';
            if (hasRunningServices) {
                actionsHTML = `
                    <div style="margin: 16px 0; padding: 16px; background: #f0fff4; border-radius: 8px; border: 1px solid #34C759;">
                        <strong>üéâ Services are running!</strong><br>
                        <button class="btn" onclick="window.open('http://localhost:3000', '_blank')" style="margin: 8px 4px 0 0;">Open Dashboard</button>
                        <button class="btn btn-outline" onclick="window.open('http://localhost:3001', '_blank')" style="margin: 8px 4px 0 0;">Open Medical App</button>
                    </div>
                `;
            } else {
                actionsHTML = `
                    <div style="margin: 16px 0; padding: 16px; background: #fff3cd; border-radius: 8px; border: 1px solid #ffc107;">
                        <strong>‚ö†Ô∏è No services detected</strong><br>
                        <p style="margin: 8px 0; font-size: 14px;">Use the installation wizard or run the reconnect script to start services.</p>
                        <button class="btn btn-outline" onclick="document.querySelector('.health-modal').remove(); document.getElementById('step1').scrollIntoView();" style="margin: 8px 4px 0 0;">Start Installation</button>
                    </div>
                `;
            }
            
            resultsDiv.innerHTML = `
                <div style="font-family: 'SF Mono', Monaco, monospace; font-size: 14px;">
                    ${results.map(result => `<div style="margin: 8px 0; padding: 8px; background: #f8f9fa; border-radius: 4px;">${result}</div>`).join('')}
                </div>
                ${actionsHTML}
                <div style="margin-top: 16px; padding: 12px; background: #e3f2fd; border-radius: 8px; font-size: 14px;">
                    <strong>üí° Quick Commands:</strong><br>
                    ‚Ä¢ Start all: <code>./reconnect.sh</code><br>
                    ‚Ä¢ Check Docker: <code>docker ps</code><br>
                    ‚Ä¢ View logs: <code>tail -f dashboard.log</code>
                </div>
            `;
        }
        
        // Helper function to copy text to clipboard
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showStatus('success', '‚úÖ Command copied to clipboard!');
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            updateProgress();
            checkForExistingInstallation();
        });
    </script>
</body>
</html>